#!/usr/bin/env node

/**
 * Marked CLI
 * Copyright (c) 2011-2013, Christopher Jeffrey (MIT License)
 */

const marked = require('marked')
const readline = require('readline')
const fs = require('fs')

const hljs = require('highlight.js')
marked.setOptions({
  highlight: (code, lang) => hljs.highlight(lang, code).value
})

process.stdin.setEncoding('utf8');
const rl = readline.createInterface({
  input: process.stdin,
});

process.stdin.on('error', function(err) {
  console.err(err)
  return process.exit(1);
});

process.stdin.on('end', function() {
  return process.exit(0);
});

//process.stdin.on('data', function(data) {
rl.on('line', function(data) {
  fs.writeFileSync('tmp/foo', data)
  data = data
    .trimEnd()
    .replace(/\\n/g, '\n')
    .replace(/\\\\/g, '\\')

  let result = marked(data)

  result = result
    .replace(/\\/g, '\\\\')
    .replace(/\n/gm, '\\n')

  process.stdout.write(result + '\n');
});
